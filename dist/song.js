"use strict";function getParameterByName(e,a){a||(a=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(a);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}function initText(e,a,i,n){var t="<li><span>"+a+"</span> - "+n;$("#title").append(t),$("#disk-image").attr("src",i),$("#page").append("<style>\n                                    #page::before{\n                                                    background:transparent url("+i+") no-repeat center center;\n                                                    background-size:cover;\n                                                  }\n                                </style>"),parseLyric.call(void 0,e)}function initPlayer(e){var a=document.createElement("audio");a.src=e,$("#play").on("click",function(){a.play(),$("#circle").addClass("playing"),$(".pointer").addClass("playing")}),$("#pause").on("click",function(){a.pause(),$("#circle").removeClass("playing"),$(".pointer").removeClass("playing")}),a.addEventListener("ended",function(){$("#circle").removeClass("playing"),$(".pointer").removeClass("playing")}),setInterval(function(){for(var e=a.currentTime,i=$(".lines>li"),n=void 0,t=0;t<i.length;t++)0!==i.eq(t+1).length&&i.eq(t).attr("data-time")<=e&&i.eq(t+1).attr("data-time")>e&&(n=i.eq(t));if(n){n.addClass("active").prev().removeClass("active");var r=n.offset().top-$(".lines").offset().top-$(".lyrics").height()/3;$(".lines").css("transform","translateY(-"+r+"px)")}},300)}function parseLyric(e){var a=[];e.split("\n").map(function(e,i){var n=e.split("]");n[0]=n[0].substring(1);var t=/(\d+):([\d.]+)/,r=n[0].match(t),l=+r[1],s=+r[2];a.push({time:60*l+s,lyric:n[1]})}),a.map(function(e){if(e){var a='<li id="li" data-time="'+e.time+'">'+e.lyric+"</li>";$(".lines").append(a)}})}var APP_ID="C97vnqMpJpDB05tNiObyKutc-gzGzoHsz",APP_KEY="REdfXRGxVNRvvUUg62V1aqjN";AV.init({appId:APP_ID,appKey:APP_KEY});var id=getParameterByName("id"),query=new AV.Query("Song");query.get(id).then(function(e){var a=e.attributes,i=a.url,n=a.lyric,t=a.image,r=a.name,l=a.singer;initPlayer.call(void 0,i),initText.call(void 0,n,r,t,l)});